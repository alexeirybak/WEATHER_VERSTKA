(()=>{"use strict";const t="cb63b0f8338542512b1cd6749d336304",e="https://api.openweathermap.org",n=document.getElementById("recent-cities-list");document.addEventListener("click",(t=>{t.target!==r&&t.target!==n&&(n.style.display="none")}));const o=document.querySelector(".search-form"),r=document.querySelector(".city-input");const a=document.getElementById("error-message");function c(t){a.textContent=t}const s=document.querySelector(".city-input"),i=t=>/^[А-Яа-яЁё\s-]+$/.test(t);s.addEventListener("input",(()=>{const t=s.value;t&&!i(t)?c("Введите на кириллице"):c("")}));const l={мск:"Москва",спб:"Санкт-Петербург",нск:"Новосибирск"},d=async(n,o,r)=>{const a=new URL(`${e}/data/2.5/${n}`),c=new URLSearchParams({lat:o,lon:r,appid:t,lang:"ru",units:"metric"});a.search=c.toString();const s=await fetch(a);if(!s.ok)throw new Error("Не удалось загрузить данные о погоде");return s.json()},u=async(t,e)=>d("weather",t,e),m=async(t,e)=>d("forecast",t,e);function h(t,e){const n=new Date(1e3*(t+e)),o=n.getUTCHours(),r=n.getUTCMinutes();return`${o}:${r<10?"0"+r:r}`}const p=document.querySelector(".city"),g=document.querySelector(".temperature"),y=document.querySelector(".feels"),w=document.querySelector(".description"),f=document.querySelector(".weather-icon img"),S=document.querySelector(".wind"),$=document.querySelector(".visibility"),C=document.querySelector(".humidity"),v=document.querySelector(".pressure"),L=document.querySelector(".sunrise"),E=document.querySelector(".sunset"),M=document.querySelector(".day-length"),x=(t,e)=>{p.textContent=e||"Неизвестно",g.textContent=`${Math.round(t.main?.temp||0)} °C`,y.textContent=`Ощущается как ${Math.round(t.main?.feels_like||0)}°C`,w.textContent=t.weather?.[0]?.description||"Неизвестно",f.src=`https://openweathermap.org/img/wn/${t.weather?.[0]?.icon||"01d"}@2x.png`,S.textContent=`${Math.round(t.wind?.speed||0)} м/с`;const n=t.visibility||0;var o;$.textContent=n>1e3?`${(n/1e3).toFixed(1)} км`:`${n} м`,C.textContent=`${t.main?.humidity||0}%`,v.textContent=`${Math.round(.750062*(t.main?.pressure||0))} мм рт.ст.`,function(t){const e=document.getElementById("wind-direction-icon"),n=document.getElementById("wind-direction-text"),o=(t+180)%360;e.style.transform=`rotate(${o}deg)`;const r=(t+360)%360,a=Math.round(r/45)%8;n.textContent=["С","СВ","В","ЮВ","Ю","ЮЗ","З","СЗ"][a]||"Н/Д"}(t.wind?.deg||0),o=t.main?.humidity||0,document.querySelector(".parameter").style.width=`${o}%`;const{sunrise:r,sunset:a}=t.sys||{},{timezone:c}=t||{};L.textContent=r?h(r,c):"Неизвестно",E.textContent=a?h(a,c):"Неизвестно",M.textContent=`Долгота дня: ${r&&a?function(t,e){const n=e-t;return`${Math.floor(n/3600)} час ${Math.floor(n%3600/60)} мин`}(r,a):"Неизвестно"}`;const s=r&&a?((t,e)=>(Math.floor(Date.now()/1e3)-t)/(e-t))(r,a):0;(t=>{const e=document.querySelector(".sun-graphic circle");if(t<0||t>1)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","visible");const n=20+160*t,o=35-45*Math.sin(t*Math.PI);e.setAttribute("cx",n),e.setAttribute("cy",o)})(s)},q=document.querySelector(".hourly-scroll"),b=t=>{q.innerHTML="",t||c("Данные о погоде недоступны");const e=new Date;e.setHours(0,0,0,0);const n=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],o=1e3*t.city.timezone;t.list.forEach((t=>{const r=new Date(1e3*t.dt+o),a=r.getHours(),c=Math.round(t.main.temp),s=t.weather[0].icon,i=new Date(r);i.setHours(0,0,0,0);const l=i.getTime()-e.getTime(),d=Math.floor(l/864e5);let u;u=0===d?"Сегодня":1===d?"Завтра":n[i.getDay()];const m=document.createElement("div");m.classList.add("hourly-item"),m.innerHTML=`\n        <p class="hour">${u}</p>\n        <p class="hour">${a}:00</p>\n        <img\n          src="https://openweathermap.org/img/wn/${s}@4x.png"\n          alt="Погода"\n        />\n        <p class="temp">${c} °C</p>\n    `,q.append(m)}))},k=document.querySelector(".forecast-list"),D=t=>{k.innerHTML="",t||c("Данные о погоде недоступны");const e=I(t.list);Object.keys(e).slice(0,5).forEach((t=>{const n=e[t],o=Math.round(Math.max(...n.map((t=>t.main.temp_max)))),r=Math.round(Math.min(...n.map((t=>t.main.temp_min)))),a=n[0].weather[0].icon,c=new Date(1e3*n[0].dt),s=c.toLocaleDateString("ru-RU",{weekday:"short"}),i=c.getDate(),l=c.toLocaleDateString("ru-RU",{month:"short"}),d=document.createElement("div");d.classList.add("forecast-item"),d.innerHTML=`\n        <p class="day">${s},</p>\n        <p class="day">${i} ${l}</p>\n        <img\n        src="https://openweathermap.org/img/wn/${a}@4x.png"\n        alt="Погода"\n        />\n        <div class="temp">\n        <p class="temp-day">${o} °C</p>\n        <p class="temp-night">${r} °C</p>\n        `,k.append(d)}))},I=t=>{const e={};return t.forEach((t=>{const n=new Date(1e3*t.dt).toLocaleDateString("ru-RU");e[n]||(e[n]=[]),e[n].push(t)})),e},T=async()=>{let n=r.value.trim();if(n)if(i(n)){n=(t=>{const e=t.toLowerCase();return l[e]?l[e]:t})(n);try{const o=`${e}/geo/1.0/direct`,r=new URLSearchParams({q:n,limit:1,appid:t}),a=await fetch(`${o}?${r.toString()}`),c=await a.json();if(!c.length)throw new Error("Город не найден");const{lat:s,lon:i}=c[0];(t=>{const e=(t=>t?["Комсомольск-на-Амуре","Ростов-на-Дону"].includes(t)?t.toLowerCase().split(/[\s-]/).map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join("-"):t.toLowerCase().split(/[\s-]/).map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" "):t)(t);let n=JSON.parse(localStorage.getItem("recentCities"))||[];n.includes(e)||(n.unshift(e),n.length>5&&n.pop(),localStorage.setItem("recentCities",JSON.stringify(n)))})(n);const l=await u(s,i),d=await m(s,i);x(l,n),b(d),D(d)}catch(t){console.error(t.message),c("Данные не получены")}}else c("Проверьте название города")},U=()=>{const t=document.querySelector(".now"),e=`${(n=new Date).toLocaleDateString("ru",{weekday:"short",day:"numeric",month:"short"})}, ${n.toLocaleTimeString("ru",{hour:"2-digit",minute:"2-digit"})}`;var n;t.textContent=`Сейчас: ${e}`};setInterval(U,6e4);const H=document.getElementById("toTop");function A(){window.scrollTo({top:0,behavior:"smooth"})}H.addEventListener("click",A),window.addEventListener("scroll",(()=>{window.scrollY>300?H.style.display="block":H.style.display="none"})),function(){const t=document.getElementById("themeSwitch");let e=!1;function n(t){document.documentElement.setAttribute("data-theme",t),e&&localStorage.setItem("theme",t)}t.addEventListener("change",(function(){let t;t="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark",e=!0,n(t)}));const o=localStorage.getItem("theme");o?n(o):"dark"==(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")?n("dark"):n(function(){const t=(new Date).getHours();return t>=7&&t<22?"light":"dark"}())}(),T(),o.addEventListener("submit",(async t=>{t.preventDefault(),T(r)})),r.addEventListener("focus",(()=>{(()=>{const t=JSON.parse(localStorage.getItem("recentCities"))||[];0!==t.length&&(n.innerHTML="",t.forEach((t=>{const e=document.createElement("li");e.textContent=t,e.addEventListener("click",(()=>{r.value=t,n.style.display="none",T(t)})),n.append(e)})),n.style.display="block")})()})),U(),document.addEventListener("DOMContentLoaded",(async()=>{try{const{latitude:n,longitude:o}=await new Promise(((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{const{latitude:n,longitude:o}=e.coords;t({latitude:n,longitude:o})}),(t=>{e(t)})):e(new Error("Геолокация не поддерживается Вашим браузером"))})),r=await(async(n,o)=>{const r=`${new URL(`${e}/geo/1.0/reverse`)}?${new URLSearchParams({lat:n,lon:o,limit:1,appid:t}).toString()}`;try{const t=await fetch(r),e=await t.json();if(e&&e.length>0){const{local_names:t}=e[0];return`${t?.ru||e[0].name}`}throw new Error("Название места не найдено")}catch(t){console.error("Ошибка при получении названия места: ",t.message),c("Ошибка при получении названия места")}})(n,o);await(async(t,e,n)=>{try{const o=await u(t,e),r=await m(t,e);x(o,n),b(r),D(r)}catch(t){console.error(t.message),c("Не удалось получить данные о погоде. Пожалуйста, попробуйте позже")}})(n,o,r)}catch(t){console.error("Ошибка при получении геолокации: ",t.message),c("Не удалось определить Ваше местоположение. Пожалуйста, введите город вручную")}})),A(),function(){const t=(new Date).getFullYear();document.getElementById("currentYear").textContent=t}(),console.log({key:"value"}.undefinedProperty.someValue)})();